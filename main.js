
//$(document).ready(function(){

var saved_markers=[["77.216034","28.612858"],["98.356812","34.175625"],["77.422714","28.730335"],["0.000000","0.000000"],["-42.819977","-5.050721"],["77.198723","28.703123"],["-42.822399","-5.103936"],["77.199554","28.718893"],["-42.819904","-5.043911"],["77.253029","28.719236"],["77.031479","28.770536"],["76.956306","28.677279"],["77.137756","28.654442"],["77.342377","28.688782"],["-16.967632","14.415614"],["106.828766","-6.189254"],["77.426834","28.740570"],["77.299118","28.612253"],["12.000000","12.000000"],["-70.314224","-18.474007"],["-70.312874","-18.475653"],["77.286758","28.752008"],["-51.213638","-30.052904"],["77.325508","28.748863"],["-5.664756","43.544037"],["0.000000","0.000000"],["0.000000","0.000000"],["10.000000","10.000000"],["106.828766","-6.189253"],["72.000000","112.000000"],["-72.000000","112.000000"],["113.003304","7.051700"],["113.003304","-7.051700"],["0.000000","0.000000"],["0.000000","0.000000"],["77.145309","28.668901"],["0.000000","0.000000"],["57.496380","-20.165279"],["77.350334","28.746487"],["77.225929","28.460806"],["2.000000","14.000000"],["2.000000","41.000000"],["76.829895","28.819593"],["77.124062","28.670963"],["77.155205","28.671148"],["77.053986","28.691191"],["77.367783","28.694803"],["0.000000","0.000000"],["77.203674","0.000000"],["-2.320000","34.919998"],["77.158356","28.704441"],["2.132243","41.487228"],["10000.000000","0.000000"],["77.368469","28.706850"],["77.113037","28.579096"],["80.645187","7.271332"],["122.957535","14.109550"],["0.000000","0.000000"],["77.131500","28.457815"],["77.182388","28.694202"],["0.000000","0.000000"],["77.080582","28.767353"],["77.231827","28.668901"],["77.228027","28.679966"],["0.000000","0.000000"],["73.857864","18.516031"],["0.000000","0.000000"],["0.000000","0.000000"],["0.000000","0.000000"],["0.000000","0.000000"],["77.390793","28.651110"],["0.000000","0.000000"],["76.981926","28.163286"],["77.215347","28.613461"],["0.000000","0.000000"],["-65.215965","-26.824188"],["77.199997","28.709999"],["77.199997","28.709999"],["77.175568","28.700132"],["72.499786","23.000914"],["77.170029","28.688782"],["0.000000","0.000000"],["-66.161896","-17.429945"],["112.767265","-7.279142"],["77.180206","28.716825"],["-16.925655","14.791582"],["-118.258865","34.042622"],["22.000000","11.000000"],["77.234642","28.687639"],["10000.000000","10000.000000"],["10000.000000","10000.000000"],["1.000000","1.000000"],["107.594940","-6.916726"],["107.602493","-6.937047"],["77.278519","28.674324"],["77.277145","28.676733"],["0.000000","0.000000"],["77.147369","28.693600"],["77.217377","28.653639"],["77.176567","28.660196"],["0.000000","0.000000"],["-41.502701","-17.865700"],["76.307098","10.026100"],["10000.000000","10000.000000"],["77.194061","28.743582"],["77.078018","28.538689"],["77.135010","28.604109"],["-99.630760","19.294121"],["77.330017","28.693600"],["-78.538597","-0.156715"],["10000.000000","10000.000000"],["0.000000","3.000000"],["32.323322","3.323432"],["34.655651","3.323432"],["76.067787","30.159760"],["77.136627","28.876333"],["77.134163","28.879416"],["28.882559","28.844072"],["-79.526520","8.999019"],["-34.000000","-70.000000"],["-70.000000","-34.000000"],["-70.737648","-34.116806"],["120.975082","14.297034"],["50.000000","25.000000"],["77.054672","28.600801"],["77.098045","28.620699"],["79.982895","12.964882"],["77.287315","28.495394"],["3.879732","36.389408"],["21.158148","51.398335"],["77.234573","28.565226"],["77.091751","28.552561"],["77.044327","28.607475"],["76.947235","28.731562"],["76.996994","28.803165"],["-99.178925","18.881737"],["-99.084953","19.349138"],["-20.366934","-40.293991"],["-20.366934","-40.293991"],["-40.293991","-20.366934"],["76.647064","10.066664"],["72.351189","33.780991"],["-70.609268","-33.423325"],["0.000000","0.000000"],["77.267532","28.700226"],["71.871246","26.389137"],["77.268906","28.676130"],["77.099991","28.495247"],["80.301567","27.718445"],["-276.891357","59.245296"],["139.921921","-24.722376"],["0.000000","0.000000"],["6.565552","53.216724"],["10.088902","36.846752"],["78.000000","678.000000"],["-68.662849","10.329600"],["77.141876","28.665287"],["76.866791","28.958792"],["77.219467","28.691793"],["0.000000","0.000000"],["77.317574","28.584518"],["77.278526","28.544147"],["1234.000000","123.000000"],["10000.000000","10000.000000"],["77.396873","29.220606"],["77.221535","28.651117"],["77.134323","28.708055"],["77.210464","28.626650"],["77.305984","28.653839"],["95.612358","5.633063"],["21.516762","41.968575"],["43.099998","20.500000"],["45.099998","20.500000"],["76.749107","28.490999"],["-73.103561","-36.736904"],["-73.103600","-36.736950"],["77.302551","28.622501"],["116.424545","-8.437811"],["116.435143","-8.434566"],["0.000000","-8.000000"],["0.000000","0.000000"],["123.000000","2123.000000"],["120.508789","14.831658"],["14.831658","120.508789"],["77.301865","28.663479"],["-10000.000000","-10000.000000"],["77.217499","28.712879"],["77.194748","28.656248"],["-55.122787","-27.487139"],["77.219467","28.652634"],["22.380690","50.033272"],["77.133636","28.706247"],["77.094269","28.556379"],["77.137436","28.694098"],["77.180054","28.636309"],["77.183075","28.648417"],["0.000000","0.000000"],["28.892683","39.240997"],["77.203674","28.738764"],["77.081451","28.755018"],["77.018608","28.680651"],["90.389893","23.868307"],["90.389893","23.868307"],["32.466869","15.628707"],["77.352783","28.458199"],["78.664146","29.305849"],["77.459686","28.650244"],["120.985435","14.644270"],["-70.559998","-33.480000"],["0.000000","0.000000"],["0.000000","0.000000"],["82.974297","25.267799"],["0.000000","0.000000"],["0.000000","0.000000"],["77.281952","28.677938"],["77.093124","28.817003"],["76.798378","29.043592"],["77.116791","28.869102"],["2.349014","48.864716"],["0.000000","0.000000"],["110.406845","-7.759817"],["-7.759817","110.406845"],["0.000000","0.000000"],["0.000000","0.000000"],["77.216721","28.682556"],["77.290878","28.731037"],["10000.000000","2323.000000"],["10000.000000","10000.000000"],["10000.000000","10000.000000"],["10000.000000","10000.000000"],["-64.332397","-22.738800"],["0.000000","0.000000"],["56.000000","56.000000"],["77.220840","28.774281"],["77.317657","28.553766"],["76.272003","28.634869"],["77.408981","28.718893"],["77.136391","28.913982"],["77.202095","28.613850"],["80.424095","8.559886"],["-77.039948","-12.114109"],["77.229767","28.667698"],["-77.039948","-12.114109"],["77.229767","-12.114109"],["77.239380","28.638170"],["77.083511","28.621130"],["-77.033272","-12.074196"],["-77.033279","-12.074404"],["-38.521114","-3.728945"],["77.224579","28.653368"],["77.221642","28.651026"],["-48.577084","-27.590132"],["-48.549664","-27.596821"],["112.235306","-6.522614"],["77.301498","28.769754"],["-9.136029","39.403427"],["-9.136027","39.403427"],["77.350571","28.613461"],["77.245560","28.624912"],["-3.738527","40.530666"],["0.000000","0.000000"],["77.139816","28.761038"],["-76.925636","-12.080538"],["-76.922874","-12.080452"],["77.112534","28.694822"],["77.208992","28.688524"],["-4.073091","5.337127"],["0.000000","0.000000"],["0.000000","0.000000"],["110.451019","1.455532"],["-47.373844","-20.544071"],["10.000000","10.000000"],["77.149429","28.684479"],["77.152855","28.635111"],["77.196121","28.750805"],["77.251740","28.670710"],["77.174835","28.696611"],["77.463715","28.811310"],["23.781872","55.466240"],["109.272705","-7.426737"],["77.230713","28.433712"],["77.242126","28.664684"],["77.304321","28.487753"],["3.000000","2.000000"],["3.000000","6.000000"],["9.000000","64.000000"],["900.000000","64.000000"],["900.000000","646.000000"]];
var user_location=[44.186271066083464,24.6246942926973];
mapboxgl.accessToken='pk.eyJ1IjoiZmFraHJhd3kiLCJhIjoiY2pscWs4OTNrMmd5ZTNra21iZmRvdTFkOCJ9.15TZ2NtGk_AtUvLd27-8xA';
var map=new mapboxgl.Map({
    container:'map',
    style:'mapbox://styles/mapbox/streets-v9',
    center:user_location,
    zoom:5
});


var geocoder=new MapboxGeocoder({
    accessToken:mapboxgl.accessToken,

    
    
});

var marker;


map.on('load', function() {
    addMarker(user_location,'load');
   
    
    geocoder.on('result', function(ev) {
        alert("a");
        console.log(ev.result.center);

    });
});
map.on('click', function(e) {
    marker.remove();
    addMarker(e.lngLat,'click');
    console.log(e);
    document.getElementById("lat").value=e.lngLat.lat;
    document.getElementById("lng").value=e.lngLat.lng;
    load_data();

});

function addMarker(ltlng,event) {

    if(event === 'click') {
        user_location=ltlng;
    }
    marker=new mapboxgl.Marker({
        draggable:true,
        color:"#d02922"
    }).setLngLat(user_location).addTo(map).on('dragend',onDragEnd);
}

function add_markers(coordinates) {

    var geojson=(saved_markers == coordinates?saved_markers:'');

    console.log(geojson);
    
    
    geojson.forEach(function(marker) {
        console.log(marker);
       
        
        new mapboxgl.Marker().setLngLat(marker).addTo(map);
    });

}

function onDragEnd() {
    var lngLat=marker.getLngLat();
    document.getElementById("lat").value=lngLat.lat;
    document.getElementById("lng").value=lngLat.lng;
    console.log(' lng: '+lngLat.lng+'<br /> lat: '+lngLat.lat);
}

function load_data(){
    var latt = $('#lat').val()
    var lngg = $('#lng').val()

    console.log(latt)
    data={lat:$("#lat").val(),lng:$("#lng").val()};
   $.ajax({
        type:"POST",
     
        url:"https://api.apixu.com/v1/forecast.json?key=d51ba43b8b0f440d99a122552192904&q=$" + latt + ",$"+ lngg + "&days=7",

      //  data:data,
        success: function(data) {
            // $("#results").html(data);
            console.log(data.location.name)
            console.log(data.current.temp_c)
            $('h5').empty().append($('<p/>').text('Location: '+ data.location.name +"  " +data.current.temp_c+"  C"))

        },error: function (xhr, ajaxOptions, thrownError) {
            console.log("NO!")

            
            document.getElementById('geocoder').appendChild(geocoder.onAdd(map));
        }
    });

    
}
